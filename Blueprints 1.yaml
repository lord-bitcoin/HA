blueprint:
  name: Gestion Climatisation
  description: Gère la climatisation définie avec des actions définies selon la saison et la plage horaire.
  domain: automation
  input:
    saison:
      name: Saison
      description: Définir manuellement la saison pour personnaliser les actions.
      selector:
        select:
          options:
            - printemps
            - ete
            - automne
            - hiver
    plage_horaire:
      name: Plage Horaire
      description: Jour ou Nuit.
      selector:
        select:
          options:
            - jour
            - nuit
    thermometres_intérieur:
      name: Capteurs de température (Intérieur)
      description: Capteur utilisé pour mesurer la température intérieure.
      selector:
        entity:
          domain: sensor
    thermometres_exterieur:
      name: Capteurs de température (Extérieur)
      description: Capteur utilisé pour mesurer la température extérieure.
      selector:
        entity:
          domain: sensor
    climatiseurs:
      name: Climatiseur
      description: Entité du climatiseur à contrôler.
      selector:
        entity:
          domain: climate
    temperature_printemps:
      name: Température cible (Printemps)
      description: Température à maintenir pendant le printemps.
      selector:
        number:
          min: 15
          max: 30
          step: 0.5
    temperature_ete:
      name: Température cible (Été)
      description: Température à maintenir pendant l'été.
      selector:
        number:
          min: 15
          max: 30
          step: 0.5
    temperature_automne:
      name: Température cible (Automne)
      description: Température à maintenir pendant l'automne.
      selector:
        number:
          min: 15
          max: 30
          step: 0.5
    temperature_hiver:
      name: Température cible (Hiver)
      description: Température à maintenir pendant l'hiver.
      selector:
        number:
          min: 15
          max: 30
          step: 0.5
    heure_debut_jour:
      name: Heure début jour
      description: Heure à laquelle commence la plage horaire jour.
      selector:
        time:
    heure_fin_jour:
      name: Heure fin jour
      description: Heure à laquelle se termine la plage horaire jour.
      selector:
        time:
    temperature_max_preservation:
      name: Température maximum pour le mode préservation
      description: Température maximale cible lors du mode préservation.
      selector:
        number:
          min: 15
          max: 30
          step: 0.5

trigger:
  - platform: state
    entity_id: !input thermometres_intérieur

condition:
  - condition: time
    after: !input heure_debut_jour
    before: !input heure_fin_jour

variables:
  temperature_cible: >
    {{ {
      'printemps': !input temperature_printemps,
      'ete': !input temperature_ete,
      'automne': !input temperature_automne,
      'hiver': !input temperature_hiver
    }[!input saison] }}

action:
  - choose:
      - conditions:
          - condition: template
            value_template: >
              {{ (states(!input thermometres_exterieur) | float) - 7 > temperature_cible }}
        sequence:
          - service: climate.set_hvac_mode
            target:
              entity_id: !input climatiseurs
            data:
              hvac_mode: cool
          - service: climate.set_temperature
            target:
              entity_id: !input climatiseurs
            data:
              temperature: >
                {{ [(states(!input thermometres_exterieur) | float) - 7, !input temperature_max_preservation] | min }}
      - conditions:
          - condition: template
            value_template: "{{ !input saison == 'printemps' }}"
        sequence:
          - service: climate.set_hvac_mode
            target:
              entity_id: !input climatiseurs
            data:
              hvac_mode: cool
          - service: climate.set_temperature
            target:
              entity_id: !input climatiseurs
            data:
              temperature: !input temperature_printemps
      - conditions:
          - condition: template
            value_template: "{{ !input saison == 'ete' }}"
        sequence:
          - service: climate.set_hvac_mode
            target:
              entity_id: !input climatiseurs
            data:
              hvac_mode: cool
          - service: climate.set_temperature
            target:
              entity_id: !input climatiseurs
            data:
              temperature: !input temperature_ete
      - conditions:
          - condition: template
            value_template: "{{ !input saison == 'automne' }}"
        sequence:
          - service: climate.set_hvac_mode
            target:
              entity_id: !input climatiseurs
            data:
              hvac_mode: heat
          - service: climate.set_temperature
            target:
              entity_id: !input climatiseurs
            data:
              temperature: !input temperature_automne
      - conditions:
          - condition: template
            value_template: "{{ !input saison == 'hiver' }}"
        sequence:
          - service: climate.set_hvac_mode
            target:
              entity_id: !input climatiseurs
            data:
              hvac_mode: heat
          - service: climate.set_temperature
            target:
              entity_id: !input climatiseurs
            data:
              temperature: !input temperature_hiver
mode: single
