blueprint:
  name: "Gestion Automatique de Climatisation"
  description: "Gestion de climatisation par saison et horaires"
  domain: automation
  input:
    climate_entity:
      name: "Climatiseur"
      selector:
        entity:
          domain: climate
    
    temp_sensor:
      name: "Capteur température"
      selector:
        entity:
          domain: sensor
          device_class: temperature
    
    target_temp:
      name: "Température cible"
      selector:
        number:
          min: 16
          max: 30
          step: 0.5
          unit_of_measurement: °C
      default: 23
    
    max_temp:
      name: "Température maximale"
      selector:
        number:
          min: 20
          max: 35
          step: 0.5
          unit_of_measurement: °C
      default: 30
    
    mode:
      name: "Mode climatisation"
      selector:
        select:
          options:
            - auto
            - cool
            - heat
      default: auto

trigger:
  - platform: state
    entity_id: !input "temp_sensor"
  - platform: time_pattern
    minutes: "/5"

condition:
  - condition: template
    value_template: "{{ states(temp_sensor)|float > states(target_temp)|float }}"

action:
  - choose:
      - conditions:
          - condition: template
            value_template: "{{ states(temp_sensor)|float > states(max_temp)|float }}"
        sequence:
          - service: climate.set_hvac_mode
            target:
              entity_id: !input "climate_entity"
            data:
              hvac_mode: cool
          - service: climate.set_temperature
            target:
              entity_id: !input "climate_entity"
            data:
              temperature: "{{ states(max_temp)|float }}"
    
    default:
      - service: climate.set_hvac_mode
        target:
          entity_id: !input "climate_entity"
        data:
          hvac_mode: "{{ states(mode) }}"
      - service: climate.set_temperature
        target:
          entity_id: !input "climate_entity"
        data:
          temperature: "{{ states(target_temp)|float }}"
